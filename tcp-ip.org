#+TITLE: tcp ip
#+AUTHOR: kumakichi

* Basics

** OSI 7层

Open Systems Interconnection

+ 物理层

  有关传输介质的特性标准:连接头、帧、帧的使用、电流、编码及光调制...

+ 数据链路层

  互联设备间传送和识别数据帧

+ 网络层

  ARP,IPV4,IPV6,ICMP,IPsec

  地址管理，路由选择

+ 传输层

  TCP,UDP,SCTP,UDP-Lite,DCCP

+ 会话层

  定义如何开始，控制，结束会话，包括消息控制和管理

  通信管理

+ 表示层

  定义数据格式及加密
  
  设备格式和网络格式的转换

+ 应用层

  应用程序:telnet,http,ftp,smtp
  
  针对特定应用的协议

** TCP/IP

来自 IETF Internet Engineering Task Force

** 传输方式

*** 面向有连接和面向无连接

    数据传输前，是否建立通信线路

*** 电路交换和分组交换

    + 电路交换
      
      通过电路交换机连接通信线路

      电路交换要求必须首先在通信双方之间建立连接通道。在连接建立成功之后，双方的通信活动才能开始。通信双方需要传递的信息都是通过已经建立好的连接来进行传递的，而且这个连接也将一直被维持到双方的通信结束。在某次通信活动的整个过程中，这个连接将始终占用着连接建立开始时，通信系统分配给它的资源（通道、带宽、时隙、码字等等）
      
      单个计算机收发消息会独占链路，其他计算机只能等待这台计算机处理结束

    + 分组交换

      由分组交换机(路由器)连接通信线路
      
      各个计算机并发地收发数据，计算机将数据分割成多个数据包，按照一定的顺序发送

** 根据接收端

*** Unicast

    单播，1对1通信

*** Broadcast

    广播，发送给与之相连的所有其他主机

*** Multicast

    多播，将消息发给多个接收主机

*** Anycast

    与多播类似，都是面向一群主机，但任播仅从目标主机群选择一台最合适网络条件的主机


** 网络构成

*** NIC
    
    For ethernet

*** Repeater

    中继器在OSI第一层延长网络, 信号放大

*** 网桥/2层交换机

    网桥在OSI的第二层，连接两个设备

    以太网的Hub也属于网桥的一种

*** 路由器/3层交换机

    在OSI的第3层，连接两个网络，并对分组报文进行转发

* TCP/IP基础

** 分层

*** 硬件(物理层)

*** 网络接口层(数据链路层)

    NIC驱动

*** 互联网层(网络层)

    IP,ICMP,ARP

*** 传输层

    TCP,UDP

*** 应用层(会话层以上的分层)

    WWW,FTP...

* 数据链路层

** MAC地址

   用于识别数据链路中互连的节点

** 根据MAC地址转发

   以太网交换机是持有多个端口的网桥，根据每个帧的目标MAC，决定从哪个网络接口发送数据

** VLAN

   即使连接同一个交换机，也可以分成不同的网段

   区分广播数据的传播范围，减少网络负载，提高了网络安全性

** 以太网

   10BASE, 100BASE 中的数字指的是 10Mbps,100Mbps

** PPP

   PPP属于纯粹的数据链路层，仅有PPP无法实现通信，还需要有物理层的支持

   主要包括两个协议:LCP(Link Control Protocol)，NCP(Network Control Protocol)

   如果上层为IP，此时的NCP也叫IPCP(IP Control Protocol)

   LCP负责建立和断开连接，设置最大接收单元(MRU,Maximum Receive Unit),设置验证协议(PAP/CHAP)

   IPCP负责IP地址设置以及是否进行TCP/IP首部压缩

* IP 协议

  大致有3大模块: IP寻址，路由，IP分包与组包

  IP属于网络层地址

  一跳(1 hop)是指利用数据链路层以下分层的功能传输数据帧的一个区间

  数据链路的最大传输单位MTU(Maximum Transmission Unit)，以太网的MTU是1500

** 无连接

   面向无连接是为了降低复杂性，而将可靠数据传输的问题留给上一层来解决

** IP地址

   由网络地址和主机地址两部分构成(net,host)

*** A,B,C,D类地址

    A,B,C,D:

    host: 0(bit6-bit0), host: 10(bit5-bit0), host: 110(bit4-bit0), host: 1110(bit3-bit0)

*** 广播地址

    主机地址部分全部为1

*** 多播

    多播使用D类地址（224.0.0.0 - 239.255.255.255）

** 子网掩码

   通过子网网络地址细分出比A，B，C类更小粒度的网络

   IP : 172.20.100.52/26 (网络地址长度26bits)
   网络地址: 172.20.100.0/26
   广播地址: 172.20.100.63/26

   10101100 00010100 *01100100 00* 110100

** 私有IP

   + A类: 10/8 (10.0.0.0 ~ 10.255.255.255.255)
   + B类: 172.16/12 (172.16.0.0 ~ 172.31.255.255)
   + C类: 192.168/16 (192.168.0.0 ~ 192.168.255.255)

全局地址由ICANN进行管理

** IP报文的分片与重组

   路由器只做分片，不做重组，经过分片的IP数据报只能由目标主机重组

** 路径MTU发现

   IP数据报设置首部的分片禁止标志为1,等到某个地方丢弃的时候，通过ICMP的不可达消息将MTU值发回

   下一次，发送到同一目标主机的IP数据报就以这个MTU为准

** IPv6

   IPv4是4个8bit字节，而IPv6是16个8bit字节

* IP Protocol

** DNS

   IP地址不便记忆

   domain --(through DNS)--> IP

** ARP

   IP --(through ARP)--> MAC

** RARP

   MAC->IP

** ICMP

   ICMP主要功能是确认IP包是否成功送达目标地址，通知在发送过程中被废弃的具体原因等


